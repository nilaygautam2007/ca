{"version":3,"sources":["api/user/user.controller.js"],"names":["index","list","exp","create","show","submit","destroy","select","reject","changePassword","me","authCallback","forgotPassword","resetPassword","json2csv","require","request","crypto","validationError","res","statusCode","err","status","json","handleError","send","req","User","find","exec","then","users","catch","fields","csv","data","setHeader","set","newUser","body","provider","role","save","user","token","jwt","sign","_id","config","secrets","session","expiresIn","options","method","url","headers","authorization","process","env","SENDGRID_API_KEY","personalizations","to","email","subject","from","name","content","type","value","error","response","Error","next","userId","params","id","findById","end","profile","phonenumber","wnumber","previous","prevyear","social","fblink","college","address","city","state","education","degree","branch","year","postal","pin","questions","why","right","past","submitted","success","findByIdAndRemove","message","selected","CASITE","oldPass","String","oldPassword","newPass","newPassword","authenticate","password","findOne","redirect","console","log","randomBytes","buf","toString","resetPasswordToken","resetPasswordExpires","Date","now","$gt","sendStatus"],"mappings":"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","file":"user.controller.js","sourcesContent":["'use strict';\n\nimport User from './user.model';\nimport config from '../../config/environment';\nimport jwt from 'jsonwebtoken';\nvar json2csv = require('json2csv');\nvar request = require(\"request\");\nvar crypto = require('crypto');\n\nfunction validationError(res, statusCode) {\n  statusCode = statusCode || 422;\n  return function(err) {\n    return res.status(statusCode).json(err);\n  };\n}\n\nfunction handleError(res, statusCode) {\n  statusCode = statusCode || 500;\n  return function(err) {\n    return res.status(statusCode).send(err);\n  };\n}\n\n/**\n * Get list of users\n * restriction: 'admin'\n */\nexport function index(req, res) {\n  return User.find({}, '-salt -password').exec()\n    .then(users => {\n      res.status(200).json(users);\n    })\n    .catch(handleError(res));\n}\n\nexport function list(req, res) {\n  return User.find({}, '-salt -password -provider -role').exec()\n    .then(users => {\n      res.status(200).json(users);\n    })\n    .catch(handleError(res));\n}\n\nexport function exp(req, res) {\n  return User.find({}, '-_id -salt -password -provider -role').exec()\n    .then(users => {\n      var fields = ['name', 'email', 'college.address', 'college.city', 'college.name', 'college.state',\n      'education.branch', 'education.degree', 'education.year', 'phonenumber', 'previous', 'prevyear',\n      'postal.address', 'postal.city', 'postal.pin', 'postal.state', 'questions.past', 'questions.right',\n      'questions.why', 'social', 'wnumber', 'fblink'];\n      var csv = json2csv({ data: users, fields: fields});\n      res.setHeader('Content-disposition', 'attachment; filename=users.csv');\n      res.set('Content-Type', 'text/csv');\n      res.status(200).send(csv);\n    })\n    .catch(handleError(res));\n}\n\n/**\n * Creates a new user\n */\nexport function create(req, res) {\n  var newUser = new User(req.body);\n  newUser.provider = 'local';\n  newUser.role = 'user';\n  return newUser.save()\n    .then(function(user) {\n      var token = jwt.sign({ _id: user._id }, config.secrets.session, {\n        expiresIn: 60 * 60 * 5\n      });\n      var options = { method: 'POST',\n        url: 'https://api.sendgrid.com/v3/mail/send',\n        headers:\n         { 'content-type': 'application/json',\n           authorization: 'Bearer ' + process.env.SENDGRID_API_KEY },\n        body:\n        { personalizations:\n           [ { to: [ { email: user.email } ],\n               subject: 'Shaastra 2019 || Campus Ambassador' } ],\n          from: { email: 'studentrelations@shaastra.org', name: 'Student Relations, Shaastra' },\n          //reply_to: { email: 'sam.smith@example.com', name: 'Sam Smith' },\n          subject: 'Shaastra 2019 || Campus Ambassador',\n          content:\n           [ { type: 'text/html',\n               value: '<html><body><p>Hello '+user.name+ ',<br><br><b>Greetings from Shaastra 2019, IIT Madras!</b> <br>Thank you for signing up for the Shaastra Campus Ambassador Program. Please complete the questionnaire on the portal by 10th July 2018, which is mandatory for selection. Further instructions pertaining to the selection process shall be intimated by mail. Meanwhile, please like and follow our Facebook page: fb.com/Shaastra for updates.<br><br>If you have any queries, drop a mail at studentrelations@shaastra.org <br><br><br>Regards, <br>Team Shaastra <br> IIT Madras</p></body></html>' } ] },\n        json: true };\n\n        request(options, function (error, response, body) {\n    if (error) throw new Error(error);\n\n    //console.log(response);\n  });\n    res.json({ token });\n    })\n    .catch(validationError(res));\n}\n\n/**\n * Get a single user\n */\nexport function show(req, res, next) {\n  var userId = req.params.id;\n\n  return User.findById(userId).exec()\n    .then(user => {\n      if(!user) {\n        return res.status(404).end();\n      }\n      res.json(user.profile);\n    })\n    .catch(err => next(err));\n}\n\nexport function submit(req, res) {\n  return User.findById(req.user._id).exec()\n    .then(user => {\n      user.phonenumber = req.body.phonenumber;\n      user.wnumber = req.body.wnumber;\n      user.previous = req.body.previous;\n      user.prevyear = req.body.prevyear;\n      user.social = req.body.social;\n      user.fblink = req.body.fblink;\n      user.college.name = req.body.college.name;\n      user.college.address = req.body.college.address;\n      user.college.city = req.body.college.city;\n      user.college.state = req.body.college.state;\n      user.education.degree = req.body.education.degree;\n      user.education.branch = req.body.education.branch;\n      user.education.year = req.body.education.year;\n      user.postal.address = req.body.postal.address;\n      user.postal.city = req.body.postal.city;\n      user.postal.state = req.body.postal.state;\n      user.postal.pin = req.body.postal.pin;\n      user.questions.why = req.body.questions.why;\n      user.questions.right = req.body.questions.right;\n      user.questions.past = req.body.questions.past;\n      user.submitted = true;\n      return user.save()\n        .then(() => {\n          res.json({success: true});\n        })\n        .catch(handleError(res));\n    });\n}\n\n/**\n * Deletes a user\n * restriction: 'admin'\n */\nexport function destroy(req, res) {\n  return User.findByIdAndRemove(req.params.id).exec()\n    .then(function() {\n      res.status(204).end();\n    })\n    .catch(handleError(res));\n}\n\nexport function select(req, res) {\n  return User.findById(req.params.id).exec()\n    .then(function(user) {\n      if(!user)\n      {\n        res.json({success: false,message: \"No User found\"});\n      }\n      else{\n      user.selected=1;\n      return user.save()\n        .then(() => {\n          var options = { method: 'POST',\n            url: 'https://api.sendgrid.com/v3/mail/send',\n            headers:\n             { 'content-type': 'application/json',\n               authorization: 'Bearer ' + process.env.CASITE },\n            body:\n            { personalizations:\n               [ { to: [ { email: user.email, name: user.name } ],\n                   subject: 'Shaastra 2018 || Campus Ambassador' } ],\n              from: { email: 'studentrelations@shaastra.org', name: 'Student Relations, Shaastra' },\n              //reply_to: { email: 'sam.smith@example.com', name: 'Sam Smith' },\n              subject: 'Shaastra 2019 || Campus Ambassador',\n              content:\n               [ { type: 'text/html',\n                   value: '<html><body><p>Hello ' +user.name+ ',<br><br> Greetings from Shaastra 2018, IIT Madras! <br><br>First of all, congratulations on being selected as a Campus Ambassador for your college. We would like to welcome you to the team behind India’s largest completely student-run technical extravaganza - Shaastra 2018.<br>With a strong team of 500 students of IIT Madras and hundreds of Campus Ambassadors across India, Shaastra 2018 aims to give the best technical experience to everyone in the country ranging from school students to engineers of the future.<br>With this in mind, we hope you have an amazing journey working with us as you represent your college.<br>Further instructions and information would be communicated to you shortly. We request you to keep checking the CA Portal as well as your email.<br><br>Looking forward to work with you.<br><br>Regards,<br>Team Shaastra<br>IIT Madras</p></body></html>' } ] },\n            json: true };\n\n            request(options, function (error, response, body) {\n        if (error) throw new Error(error);\n\n        //console.log(response);\n      });\n          res.json({success: true, message: \"User updated\"});\n        })\n        .catch(handleError(res));\n     }\n    })\n    .catch(handleError(res));\n}\n\nexport function reject(req, res) {\n  return User.findById(req.params.id).exec()\n    .then(function(user) {\n      if(!user)\n      {\n        res.status(400).json({message: \"No User found\"});\n      }\n      else{\n      user.selected=2;\n      var name=user.name,email=user.email;\n      return user.save()\n        .then(() => {\n          var options = { method: 'POST',\n            url: 'https://api.sendgrid.com/v3/mail/send',\n            headers:\n             { 'content-type': 'application/json',\n               authorization: 'Bearer ' + process.env.CASITE },\n            body:\n            { personalizations:\n               [ { to: [ { email: user.email, name: 'Akshay' } ],\n                   subject: 'Shaastra 2018 || Campus Ambassador' } ],\n              from: { email: 'studentrelations@shaastra.org', name: 'Student Relations, Shaastra' },\n              //reply_to: { email: 'sam.smith@example.com', name: 'Sam Smith' },\n              subject: 'Shaastra 2018 || Campus Ambassador',\n              content:\n               [ { type: 'text/html',\n                   value: '<html><body><p>Hello '+user.name+ ',<br><br> Greetings from Shaastra 2018, IIT Madras! <br><br>We regret to inform you that your application for being a Shaastra Campus Ambassador couldn’t be accommodated. However, lose hope not, for you can try again for next year - which will see a bigger CA Program.<br>Till then, get a feel of Shaastra - visit the IIT Madras campus in January and experience the largest student-run technical extravaganza. With a host of workshops, international competitions, lectures, exhibitions and shows, Shaastra is bound to amaze you.<br><br>We look forward to see you at Shaastra 2018, and as a Campus Ambassador next year!<br><br>Regards,<br>Team Shaastra<br>IIT Madras</p></body></html>' } ] },\n            json: true };\n\n            request(options, function (error, response, body) {\n        if (error) throw new Error(error);\n\n        //console.log(response);\n      });\n          res.status(200).json({message: \"User updated\"});\n        })\n        .catch(handleError(res));\n     }\n    })\n    .catch(handleError(res));\n}\n\n/**\n * Change a users password\n */\nexport function changePassword(req, res) {\n  var userId = req.user._id;\n  var oldPass = String(req.body.oldPassword);\n  var newPass = String(req.body.newPassword);\n\n  return User.findById(userId).exec()\n    .then(user => {\n      if(user.authenticate(oldPass)) {\n        user.password = newPass;\n        return user.save()\n          .then(() => {\n            res.status(204).end();\n          })\n          .catch(validationError(res));\n      } else {\n        return res.status(403).end();\n      }\n    });\n}\n\n/**\n * Get my info\n */\nexport function me(req, res, next) {\n  var userId = req.user._id;\n\n  return User.findOne({ _id: userId }, '-salt -password').exec()\n    .then(user => { // don't ever give out the password or salt\n      if(!user) {\n        return res.status(401).end();\n      }\n      res.json(user);\n      return ;\n    })\n    .catch(err => next(err));\n}\n\n/**\n * Authentication callback\n */\nexport function authCallback(req, res) {\n  res.redirect('/');\n}\n\nexport function forgotPassword (req, res, next) {\n  console.log(\"Came here forgot password\");\n  crypto.randomBytes(25, (err, buf) => {\n    if(err) { return handleError(res, err); }\n    var token = buf.toString('hex');\n    console.log(req.body.email);\n    // console.log(\"token : \",token, \" \\n mail\", req.body.email);\n    User.findOne({ email: req.body.email }).then( (user, err)=> {\n      if(err) {\n        return handleError(res, err); }\n      if(!user) {\n        return res.status(404).end(); }\n  console.log(\"Came here user find\", user.name);\n\n      user.resetPasswordToken = token;\n      user.resetPasswordExpires = Date.now() + 1800000; // half an hour to reset\n      user.save()\n        .then(user => {\n  console.log(\"Came here user.save\",user.name);\n\n          var options = { method: 'POST',\n            url: 'https://api.sendgrid.com/v3/mail/send',\n            headers:\n             { 'content-type': 'application/json',\n               authorization: 'Bearer ' + process.env.SENDGRID_API_KEY },\n            body:\n            { personalizations:\n               [ { to: [ { email: user.email, name: user.name } ],\n                   subject: 'Shaastra 2019 || Campus Ambassador' } ],\n              from: { email: 'studentrelations@shaastra.org', name: 'Student Relations, Shaastra' },\n              //reply_to: { email: 'sam.smith@example.com', name: 'Sam Smith' },\n              subject: 'Shaastra 2019 || Campus Ambassador',\n              content:\n               [ { type: 'text/html',\n                   value: \"<table style=\\\"background-color: #f3f3f3; font-family: verdana, tahoma, sans-serif; color: black; padding: 30px;\\\">\" +\n                    \"<tr> <td>\" +\n                    \"<h2>Hello \" + user.name + \",</h2>\" +\n                    \"<p>Greetings from Shaastra-2019 team.</p>\" +\n                    \"<p>You have received this email since you have requested for password change for your Shaastra account.</p>\" +\n                    \"<p>Please click on the following link, or paste this into your browser to complete the process:\" +\n                    \"<p> ca.shaastra.org/resetpassword/\" + user.email + \"/\" + token + \"</p>\" +\n                    // \"<p>http://shaastra.org/#/reset-password/\" + token + \"</p>\" +\n                    \"<p>If you did not request this, please ignore this email and your password will remain unchanged.</p>\" +\n                    \"Best,<br/> Shaastra 2019 team</p> </td> </tr> </table>\" } ] },\n            json: true };\n\n          request(options, function (error, response, body) {\n            if (error) throw new Error(error);\n          console.log(\"Came here req body\");\n          return res.json({success: true, message: 'Password Reset Mail Sent to' + req.body.email});\n\n          //console.log(response);\n          });\n        }); //user.save()\n      }); //user.find()\n    }) //random bytes\n //random bytes\n return ;\n  } //forget password\n\n/**\n * Resets the password of the user\n *\n * @param  {[type]} req [description]\n * @param  {[type]} res [description]\n * @return {[type]}     [description]\n */\nexport function resetPassword(req, res) {\n  console.log(\"reset password\\n\\n\",req.params);\n  // console.log(req.body.newPassword);//Severe Breach of Security Not me :P\n\n  User.findOne({ resetPasswordToken: req.params.token, email:req.params.email, resetPasswordExpires: { $gt: Date.now() } }).then((user, err)=>{\n  // User.findOne({ resetPasswordToken: req.params.token, resetPasswordExpires: { $gt: Date.now() } }).then((err, user)=>{\n\n      console.log(\"\\n user\", user,\"\\nerr \",err)\n      if(err) { return handleError(res, err); }\n      if(!user) {\n       console.log(\"err !user reset password\", user);\n       return res.sendStatus(404); }\n      console.log(\"no error in findone\");\n      user.password = req.body.newPassword;\n      user.resetPasswordToken = '';\n      // user.updatedOn = Date.now();\n\n\n      user.save().then((user)=>{\n        console.log(\"save pass err\",err,\"user,\",user);\n        if(err) { return handleError(res, err); }\n          var options = { method: 'POST',\n            url: 'https://api.sendgrid.com/v3/mail/send',\n            headers:\n             { 'content-type': 'application/json',\n               authorization: 'Bearer ' + process.env.CASITE },\n            body:\n            { personalizations:\n               [ { to: [ { email: user.email, name: user.name } ],\n                   subject: 'Shaastra 2018 || Campus Ambassador' } ],\n              from: { email: 'support@shaastra.org', name: 'Student Relations, Shaastra' },\n              //reply_to: { email: 'sam.smith@example.com', name: 'Sam Smith' },\n              subject: 'Shaastra 2018 || Campus Ambassador',\n              content:\n               [ { type: 'text/html',\n                   value: \"<table style=\\\"background-color: #f3f3f3; font-family: verdana, tahoma, sans-serif; color: black; padding: 30px;\\\">\" +\n                    \"<tr> <td>\" +\n                    \"<h2>Hello \" + user.name + \",</h2>\" +\n                    \"<p>Greetings from Shaastra-2019 team.</p>\" +\n                    \"<p>This is a confirmation that the password for your account <b>\" + user.email + \"</b> has just been changed</p>\" +\n                    \"Best,<br/> Shaastra 2019 team</p> </td> </tr> </table>\" } ] },\n            json: true };\n\n          request(options, function (error, response, body) {\n            if (error) throw new Error(error);\n            console.log(\"\\n\\nEnd of reset\");\n            return res.json({success: true, message: 'successfully changed Password'});\n\n          //console.log(response);\n          });\n      }); //User.save();\n\n  });\n  return ;\n}\n"]}