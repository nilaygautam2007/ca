{"version":3,"sources":["api/upload/upload.controller.js"],"names":["uploadFile","saveWithName","storage","multer","diskStorage","destination","req","file","cb","filename","fieldname","Date","now","originalname","split","pop","upload","single","res","task","params","id","user","_id","err","json","success","msg","name","User","findOne","files","push","taskid","save"],"mappings":"AAAA;;;;;QAoBgBA,U,GAAAA,U;;AAlBhB;;;;AACA;;;;AACA;;;;;;AAEA,IAAIC,eAAe,QAAnB;AACA,IAAIC,UAAUC,iBAAOC,WAAP,CAAmB;AAC/BC,eAAa,qBAASC,GAAT,EAAcC,IAAd,EAAoBC,EAApB,EAAwB;AACnCA,OAAG,IAAH,EAAS,uBAAT;AACD,GAH8B;AAI/BC,YAAU,kBAASH,GAAT,EAAcC,IAAd,EAAoBC,EAApB,EAAwB;;AAEhCP,mBAAeM,KAAKG,SAAL,GAAiB,GAAjB,GAAuBC,KAAKC,GAAL,EAAvB,GAAoC,GAApC,GAA0CL,KAAKM,YAAL,CAAkBC,KAAlB,CAAwB,GAAxB,EAA6BC,GAA7B,EAAzD;AACAP,OAAG,IAAH,EAASP,YAAT;AACD;AAR8B,CAAnB,CAAd;;AAWA,IAAIe,SAAS,sBAAO,EAACd,SAASA,OAAV,EAAP,EAA2Be,MAA3B,CAAkC,cAAlC,CAAb;;AAEO,SAASjB,UAAT,CAAoBM,GAApB,EAAyBY,GAAzB,EAA8B;AACnC,MAAIC,OAAQb,IAAIc,MAAJ,CAAWC,EAAvB;AACA,MAAIC,OAAOhB,IAAIgB,IAAJ,CAASC,GAApB;AACAP,SAAOV,GAAP,EAAYY,GAAZ,EAAiB,eAAO;;AAEtB,QAAIM,GAAJ,EAAS;;AAEP,aAAON,IAAIO,IAAJ,CAAS,EAACC,SAAS,KAAV,EAAkBC,KAAK,4BAAvB,EAAqDC,MAAM,sBAA3D,EAAT,CAAP;AACD;AACDC,mBAAKC,OAAL,CAAa,EAACP,KAAKD,IAAN,EAAb,EAAyB,UAASE,GAAT,EAAaF,IAAb,EAAkB;AACzC,UAAGE,GAAH,EAAQ,MAAMA,GAAN;AACRF,WAAKS,KAAL,CAAWC,IAAX,CAAgB;AACdC,gBAAQd,IADM;AAEdS,cAAM3B;AAFQ,OAAhB;AAIAqB,WAAKY,IAAL,CAAU,UAASV,GAAT,EAAa;AACrB,YAAGA,GAAH,EAAQ,MAAMA,GAAN;AACRN,YAAIO,IAAJ,CAAS,EAACC,SAAS,IAAV,EAAgBC,KAAK,gBAArB,EAAuCN,IAAIC,KAAKC,GAAhD,EAAT;AACD,OAHD;AAID,KAVD;AAWD,GAjBD;AAkBD","file":"upload.controller.js","sourcesContent":["'use strict';\n\nimport jsonpatch from 'fast-json-patch';\nimport multer from 'multer';\nimport User from '../user/user.model';\n\nvar saveWithName = \"Noname\";\nvar storage = multer.diskStorage({\n  destination: function(req, file, cb) {\n    cb(null, 'client/assets/uploads')\n  },\n  filename: function(req, file, cb) {\n\n    saveWithName = file.fieldname + '-' + Date.now() + \".\" + file.originalname.split('.').pop();\n    cb(null, saveWithName)\n  }\n});\n\nvar upload = multer({storage: storage}).single('uploadedFile');\n\nexport function uploadFile(req, res) {\n  var task =  req.params.id;\n  var user = req.user._id;\n  upload(req, res, err => {\n\n    if (err) {\n\n      return res.json({success: false,  msg: \"Error while uploading file\", name: 'no file was uploaded'});\n    }\n    User.findOne({_id: user},function(err,user){\n      if(err) throw err;\n      user.files.push({\n        taskid: task,\n        name: saveWithName\n      });\n      user.save(function(err){\n        if(err) throw err;\n        res.json({success: true, msg: \"File Uploaded!\", id: user._id});\n      });\n    });\n  });\n}\n"]}