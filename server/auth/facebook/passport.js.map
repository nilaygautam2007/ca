{"version":3,"sources":["auth/facebook/passport.js"],"names":["setup","User","config","passport","serializeUser","user","done","id","deserializeUser","findById","err","use","FacebookStrategy","clientID","facebook","clientSecret","callbackURL","profileFields","accessToken","refreshToken","profile","console","log","findOne","exec","then","name","displayName","email","emails","value","role","fbdob","_json","birthday","provider","save","savedUser","catch"],"mappings":";;;;;QAGgBA,K,GAAAA,K;;AAHhB;;;;AACA;;;;AAEO,SAASA,KAAT,CAAeC,IAAf,EAAqBC,MAArB,EAA6B;AAClCC,qBAASC,aAAT,CAAuB,UAASC,IAAT,EAAeC,IAAf,EAAqB;AAC5CA,SAAK,IAAL,EAAWD,KAAKE,EAAhB;AACD,GAFC;;AAIFJ,qBAASK,eAAT,CAAyB,UAASD,EAAT,EAAaD,IAAb,EAAmB;AAC1CL,SAAKQ,QAAL,CAAcF,EAAd,EAAkB,UAASG,GAAT,EAAcL,IAAd,EAAoB;AACpCC,WAAKI,GAAL,EAAUL,IAAV;AACD,KAFD;AAGD,GAJD;AAKEF,qBAASQ,GAAT,CAAa,IAAIC,0BAAJ,CAAqB;AAChCC,cAAUX,OAAOY,QAAP,CAAgBD,QADM;AAEhCE,kBAAcb,OAAOY,QAAP,CAAgBC,YAFE;AAGhCC,iBAAad,OAAOY,QAAP,CAAgBE,WAHG;AAIhCC,mBAAe,CACb,aADa,EAEb,QAFa,EAGb,MAHa,EAIb,UAJa;AAJiB,GAArB,EAWb,UAASC,WAAT,EAAsBC,YAAtB,EAAoCC,OAApC,EAA6Cd,IAA7C,EAAmD;AACjDe,YAAQC,GAAR,CAAYF,OAAZ;AACAnB,SAAKsB,OAAL,CAAa,EAAC,eAAeH,QAAQb,EAAxB,EAAb,EAA0CiB,IAA1C,GACGC,IADH,CACQ,gBAAQ;AACZ,UAAGpB,IAAH,EAAS;AACP,eAAOC,KAAK,IAAL,EAAWD,IAAX,CAAP;AACD;;AAEDA,aAAO,IAAIJ,IAAJ,CAAS;AACdyB,cAAMN,QAAQO,WADA;AAEdC,eAAOR,QAAQS,MAAR,CAAe,CAAf,EAAkBC,KAFX;AAGdC,cAAM,MAHQ;AAIdC,eAAOZ,QAAQa,KAAR,CAAcC,QAJP;AAKdC,kBAAU,UALI;AAMdrB,kBAAUM,QAAQa;AANJ,OAAT,CAAP;AAQA5B,WAAK+B,IAAL,GACGX,IADH,CACQ;AAAA,eAAanB,KAAK,IAAL,EAAW+B,SAAX,CAAb;AAAA,OADR,EAEGC,KAFH,CAES;AAAA,eAAOhC,KAAKI,GAAL,CAAP;AAAA,OAFT;AAGD,KAjBH,EAkBG4B,KAlBH,CAkBS;AAAA,aAAOhC,KAAKI,GAAL,CAAP;AAAA,KAlBT;AAmBD,GAhCY,CAAb;AAmCD","file":"passport.js","sourcesContent":["import passport from 'passport';\nimport {Strategy as FacebookStrategy} from 'passport-facebook';\n\nexport function setup(User, config) {\n  passport.serializeUser(function(user, done) {\n  done(null, user.id);\n});\n\npassport.deserializeUser(function(id, done) {\n  User.findById(id, function(err, user) {\n    done(err, user);\n  });\n});\n  passport.use(new FacebookStrategy({\n    clientID: config.facebook.clientID,\n    clientSecret: config.facebook.clientSecret,\n    callbackURL: config.facebook.callbackURL,\n    profileFields: [\n      'displayName',\n      'emails',\n      'link',\n      'birthday'\n    ]\n  },\n  function(accessToken, refreshToken, profile, done) {\n    console.log(profile);\n    User.findOne({'facebook.id': profile.id}).exec()\n      .then(user => {\n        if(user) {\n          return done(null, user);\n        }\n\n        user = new User({\n          name: profile.displayName,\n          email: profile.emails[0].value,\n          role: 'user',\n          fbdob: profile._json.birthday,\n          provider: 'facebook',\n          facebook: profile._json\n        });\n        user.save()\n          .then(savedUser => done(null, savedUser))\n          .catch(err => done(err));\n      })\n      .catch(err => done(err));\n  }));\n\n\n}\n"]}